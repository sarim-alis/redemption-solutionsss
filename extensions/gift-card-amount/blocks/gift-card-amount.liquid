{{ 'gift-card-amount.css' | asset_url | stylesheet_tag }}

<div class="jiffy-gift-card-container">
  <div class="gift-card-wrapper">
    <!-- Gift Card Image -->
    <div class="gift-card-image">
      {% if block.settings.card_image != blank %}
        <img src="{{ block.settings.card_image | image_url: width: 400, height: 250 }}" 
             alt="{{ block.settings.card_title | default: 'Gift Card' }}"
             width="400" 
             height="250">
      {% else %}
        <div class="default-gift-card">
          <div class="gift-card-text">
            <h2>GIFT<br>CARD</h2>
            <div class="card-logo">{{ block.settings.card_title | default: 'GIFT CARD' }}</div>
          </div>
        </div>
      {% endif %}
    </div>
    
    <!-- Gift Card Form -->
    <div class="gift-card-form">
      <form action="{{ routes.cart_add_url }}" method="post" enctype="multipart/form-data" class="gift-card-add-form">
        <input type="hidden" name="id" value="{{ block.settings.gift_card_product.selected_or_first_available_variant.id }}">
        
        <!-- Amount Input -->
        <div class="amount-input-container">
          <span class="currency-symbol">$</span>
          <input type="number" 
                 class="amount-input"
                 placeholder="Enter Amount" 
                 min="{{ block.settings.min_amount | default: 1 }}"
                 max="{{ block.settings.max_amount | default: 1000 }}"
                 step="0.01"
                 required>
        </div>
        
        <!-- Hidden quantity field for amount transfer -->
        <input type="hidden" name="quantity" class="quantity-field" value="1">
        
        <!-- Display Quantity Controls (for show only) -->
        <div class="quantity-section">
          <div class="quantity-controls">
            <button type="button" class="quantity-btn minus-btn">âˆ’</button>
            <input type="number" class="quantity-display" value="1" min="1" max="10" readonly>
            <button type="button" class="quantity-btn plus-btn">+</button>
          </div>
        </div>
        
        <!-- Add to Cart Button -->
        <button type="submit" class="add-to-cart-btn">
          {{ block.settings.button_text | default: 'ADD TO CART' }}
        </button>
      </form>
    </div>
  </div>
</div>

<!-- JavaScript for Amount Transfer -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const forms = document.querySelectorAll('.gift-card-add-form');
  
  forms.forEach(form => {
    const amountInput = form.querySelector('.amount-input');
    const quantityField = form.querySelector('.quantity-field');
    const quantityDisplay = form.querySelector('.quantity-display');
    const minusBtn = form.querySelector('.minus-btn');
    const plusBtn = form.querySelector('.plus-btn');
    
    // Quantity controls for display
    minusBtn.addEventListener('click', function() {
      const currentValue = parseInt(quantityDisplay.value);
      if (currentValue > 1) {
        quantityDisplay.value = currentValue - 1;
      }
    });
    
    plusBtn.addEventListener('click', function() {
      const currentValue = parseInt(quantityDisplay.value);
      if (currentValue < 10) {
        quantityDisplay.value = currentValue + 1;
      }
    });
    
    // Form submission - transfer amount to quantity
    form.addEventListener('submit', function(e) {
      const customAmount = parseFloat(amountInput.value);
      
      if (customAmount && customAmount > 0) {
        // Transfer customer amount to quantity field (clever trick!)
        quantityField.value = Math.round(customAmount);
        
        console.log('Customer entered amount:', customAmount);
        console.log('Transferred to quantity:', Math.round(customAmount));
        
        // Add loading state
        const submitBtn = form.querySelector('.add-to-cart-btn');
        submitBtn.textContent = 'Adding...';
        submitBtn.disabled = true;
      } else {
        e.preventDefault();
        alert('Please enter a valid amount');
      }
    });
  });
});
</script>

<script src="{{ 'gift-card-amount.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Custom Gift Card Amount",
  "target": "section",
  "settings": [
    {
      "type": "header",
      "content": "Gift Card Settings"
    },
    {
      "type": "product",
      "id": "gift_card_product",
      "label": "Select Gift Card Product",
      "info": "Choose the gift card product from your store"
    },
    {
      "type": "image_picker",
      "id": "card_image",
      "label": "Gift Card Design Image"
    },
    {
      "type": "text",
      "id": "card_title",
      "label": "Card Title",
      "default": "GIFT CARD"
    },
    {
      "type": "number",
      "id": "min_amount",
      "label": "Minimum Amount",
      "default": 1
    },
    {
      "type": "number",
      "id": "max_amount", 
      "label": "Maximum Amount",
      "default": 1000
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "ADD TO CART"
    },
    {
      "type": "color",
      "id": "card_bg_color",
      "label": "Card Background Color",
      "default": "#8b2635"
    },
    {
      "type": "color",
      "id": "button_bg_color", 
      "label": "Button Background Color",
      "default": "#8b2635"
    }
  ]
}
{% endschema %}
